#!/usr/bin/bash

if ! type "arthur" > /dev/null; then
    echo "Install arthur"
    exit 1
fi

REMOTE_ORIGIN=$(git config --get remote.origin.url)

if [[ "$REMOTE_ORIGIN" =~ "@gitlab.zimpler.com" ]]; then
    REPO_NAME=$(echo $REMOTE_ORIGIN | grep -o '\/.*\.' | tr -d '/.')
elif [[ "$REMOTE_ORIGIN" =~ "@github.com:Zimpler" ]]; then
    REPO_NAME=$(git config --get remote.origin.url | grep -o '\/.*\.' | tr -d '/.\n')
else
    echo "Only allowed on repos owned by Zimpler"
    exit 1
fi

arthur rollback-to-main $REPO_NAME staging && \
    notify-send "Rollback" "$REPO_NAME staging was rolled back"
